# 布林带与无套利区间结合下的ETF期现套利策略
## 一、策略理论
## 1. 股指期货与交易型开放式指数基金ETF
ETF 是一种在证券交易所上市交易的基金，通常跟踪某个指数、行业或资产类别。股指期货是以股票指数为标的的标准化期货合约，买卖双方约定在未来某一时间按约定价格交割。在ETF期现套利模型中，我们将ETF基金来作为现货。与股票相比，其优势在于流动性强，不存在当天无法交易等特殊情况的风险。
## 2. 简单对冲
首先我们需要讨论在理论条件下，对冲时的股指期货与ETF的交易数量，在这里不进行复杂的推导。以沪深300股指期货（IF）为例，申明$`IFprice`$为股指期货的价格，$`ETFprice`$为ETF基金的价格。假设当前指数价格为$`P`$，ETF价格与指数点位的乘数关系为$`u`$，则每单位ETF的价值为$`\frac{P}{u}  `$，股指期货合约乘数为$`k`$，则每单位IF的市值为$`P \times k`$。对冲的核心是使1单位股指期货的市值变动与n单位ETF的市值变动完全抵消，则有$`n \times \frac{P}{u} = P \times k`$，可以得到每对冲1单位的ETF，需要反向操作n单位的IF，其中：
<p align="center">$n = k \times u$</p>

## 3. 价差与布林带
股指期货与ETF的价差$`spread = IFprice -  ETFprice \times u`$。在股指期货刚上市的第一天，不进行交易，而是对价差数据进行收集。可以得到共240条的分钟频率的价差数据。然后求得价差$`spread`$的平均值$`avg`$与标准差$`std`$，那么上市第二天的第一分钟的布林带中轨$`BOLL_{mid} = avg`$，布林带上轨$`BOLL_{up} = avg + std`$，布林带下轨为$`BOLL_{low} = avg - std`$。此后，将昨日第一个价差数据剔除，加入当日新一分钟的价差数据，并重新对布林带进行计算，这就是布林带滚动数据。
布林带可以用来刻画数据的变动幅度，价差的波动大多数位于布林带之间。因此，当价差大于布林带上轨时，布林带判断此时价格出现异常，存在套利空间，进行正向套利，即卖空IF，同时买入同等价值的ETF进行对冲。待到价差回归到布林带上轨时，进行平仓，结束正向套利。同理，当价差小于布林带下轨时，可以进行反向套利，即买入股指期货，同时卖空同等价值的ETF进行对冲。待到价差回归到布林带下轨时，进行平仓，结束反向套利。
## 4. 手续费与无套利区间
在高频交易下，价格变动频繁，且期货平今仓手续费率极高，很容易导致理论利润小于手续费支出的情况，导致最终的亏损。因此，要对理论收益与手续费进行对比，如果理论收益大于手续费，则该交易是可行的。
对于IF，假设平非今仓手续费率为$`α_1`$每点，平今仓手续费率为$`α_2`$每点。ETF的交易手续费为$`β`$。注意，交易手续费在开仓和平仓时分别收取。同样采用简化模型，由于开仓与平仓时，价格变化不大，在计算手续费时可以将开仓与平仓价格近似等同。平非今仓情况下，手续费
<p align="center">$cost_1 = 2α_1\times IFprice + 2 k\times u\timesβ\times ETFprice$</p>
同理平今仓手续费为
<p align="center">$cost_0 =α_1\times IFprice+α_2\times IFprice + 2k\times u\times β\times ETFprice$</p>
## 5. 交易时机
设计一个简单的交易策略。一般而言，平今仓的手续费要比非平金仓的手续费率要高得多，因此考虑cost_otherday < cost_today 的情况。交易逻辑为，当仓位为0，spread > up，且理论profit > cost_otherday，开仓交易。当仓位不为0，spread < up时，如果上个交易是否发生在当天，且满足profit > cost_today，则今仓；如果上个交易未发生在当天，则平非金仓。

## 二、其他信息
### 1. 交易标的
本策略为ETF期现套利，选用的交易标的分别为沪深300股指期货（代码为IF2004），以及多支沪深300ETF基金，例如广发沪深300ETF、博时沪深300ETF、华夏沪深300ETF等。代码中以南方沪深300ETF为例（代码为159925.XSHE）。
### 2. 回测时间
为了研究意义更加明确，对股指期货的整个过程进行回测。以IF2004为例，其上市日期为2020-02-24，交割日期为2020-04-17，选定为回测区间
### 3. 数据来源
可从米筐平台直接调用，数据频次为日频

## 三、回测结果
### 1. 
